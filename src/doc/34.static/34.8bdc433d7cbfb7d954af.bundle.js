webpackJsonp([34],{13:function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)(),exports.push([module.id,".now-button{display:block;box-sizing:border-box;text-align:center}.now-button.now-button-large{width:200px;height:40px;line-height:40px;border-radius:40px;font-size:16px}.now-button.now-button-middle{width:100px;height:30px;line-height:30px;border-radius:30px;font-size:14px}.now-button.now-button-small{width:80px;height:26px;line-height:26px;border-radius:26px;font-size:12px}.now-button.now-button-type1{border:1px solid #05d380;background-color:transparent;color:#000}.now-button.now-button-type1.pressed,.now-button.now-button-type1:active{opacity:.5}.now-button.now-button-type1.disabled{border-color:#e6e6e6;color:#bbb}.now-button.now-button-type1.disabled:active{opacity:1}.now-button.now-button-type2{background-color:#05d380;color:#fff}.now-button.now-button-type2.pressed,.now-button.now-button-type2:active{opacity:.5}.now-button.now-button-type2.disabled{background-color:#e6e6e6}.now-button.now-button-type2.disabled:active{opacity:1}.now-button.now-button-type3{border:1px solid #333}.now-button.now-button-type3.pressed,.now-button.now-button-type3:active{opacity:.5}.now-button.now-button-type3.disabled{border-color:#e6e6e6}.now-button.now-button-type3.disabled:active{opacity:1}",""])},14:[1831,13],16:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==("undefined"==typeof call?"undefined":_typeof(call))&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof superClass?"undefined":_typeof(superClass)));subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.__esModule=!0;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};__webpack_require__(14);var _react=__webpack_require__(1),_react2=_interopRequireDefault(_react),sizeList=["small","large","middle"],Button=function(_Component){function Button(){return _classCallCheck(this,Button),_possibleConstructorReturn(this,_Component.apply(this,arguments))}return _inherits(Button,_Component),Button.prototype.render=function(){var _props=this.props,type=(_props.style,_props.type),size=_props.size,disabled=_props.disabled,className=_props.className,children=_props.children;(type>3||type<0)&&(type=1,console.warn("now-button 允许使用的 type 只有 1 2 3")),sizeList.indexOf(size)<0&&(type="large",console.warn("now-button 支持的 size 只支持 small middle large"));var buttonClass="now-button now-button-type"+type+" now-button-"+size+(className||"");return buttonClass+=disabled?" disabled":"",_react2.default.createElement("div",_extends({},this.props,{className:buttonClass}),children)},Button}(_react.Component);Button.propTypes={type:_react.PropTypes.number,size:_react.PropTypes.string,style:_react.PropTypes.object,disabled:_react.PropTypes.bool},Button.defaultProps={type:1,disabled:!1,size:"large",style:{}},exports.default=Button},287:function(module,exports){"use strict";function get(url){return cache[url]?cache[url]instanceof Image?Promise.resolve(cache[url]):cache[url]:cache[url]=new Promise(function(resolve,reject){var img=new Image;img.onload=function(){cache[url]=img,resolve(img)},img.onerror=function(){cache[url]=null,resolve(null)},img.src=url})}exports.__esModule=!0;var cache={},imageCache={get:get};exports.default=imageCache},663:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(1),_react2=_interopRequireDefault(_react),_sandbox=__webpack_require__(7),_src=__webpack_require__(665),_src2=_interopRequireDefault(_src),_nowBaseButton=__webpack_require__(16),_nowBaseButton2=_interopRequireDefault(_nowBaseButton),CustomGiftWrapper=function(_Component){function CustomGiftWrapper(){var _ref,_temp,_this,_ret;_classCallCheck(this,CustomGiftWrapper);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _temp=_this=_possibleConstructorReturn(this,(_ref=CustomGiftWrapper.__proto__||Object.getPrototypeOf(CustomGiftWrapper)).call.apply(_ref,[this].concat(args))),_this.clear=function(){_this.setState({customGift:null})},_this.play=function(){_this.setState({customGift:mockData})},_this.state={customGift:mockData},_ret=_temp,_possibleConstructorReturn(_this,_ret)}return _inherits(CustomGiftWrapper,_Component),_createClass(CustomGiftWrapper,[{key:"render",value:function(){return _react2.default.createElement("div",null,_react2.default.createElement(_nowBaseButton2.default,{onClick:this.play},"展示个性礼物"),_react2.default.createElement(_nowBaseButton2.default,{onClick:this.clear},"清除个性礼物"),this.state.customGift?_react2.default.createElement(_src2.default,_extends({ref:"customGift"},this.state.customGift)):null)}}]),CustomGiftWrapper}(_react.Component);exports.default=CustomGiftWrapper;var mockData={list:[{x:411,y:199},{x:336,y:193},{x:261,y:193},{x:188,y:207},{x:120,y:237},{x:73,y:294},{x:52,y:366},{x:35,y:439},{x:35,y:513},{x:64,y:582},{x:109,y:641},{x:171,y:682},{x:244,y:699},{x:319,y:701},{x:392,y:688},{x:460,y:657},{x:524,y:619},{x:575,y:564},{x:597,y:493},{x:597,y:418},{x:563,y:352},{x:516,y:295},{x:467,y:239}],isLongpoll:!1,iconSrc:"//8.url.cn/huayang/resource/now/new_gift/qiqiu.png?1475127040",anchorNick:"adamhe"};_sandbox.sandboxStore.add("customgift",CustomGiftWrapper)},665:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(1),_react2=_interopRequireDefault(_react),_nowUtilImagecache=__webpack_require__(287),_nowUtilImagecache2=_interopRequireDefault(_nowUtilImagecache);__webpack_require__(1558);var CustomGift=function(_Component){function CustomGift(){_classCallCheck(this,CustomGift);var _this=_possibleConstructorReturn(this,(CustomGift.__proto__||Object.getPrototypeOf(CustomGift)).call(this));return _this.list=[],_this.isLongpoll=null,_this.radius=75,_this.image=null,_this.ratateCount=0,_this.rotation=0,_this.degree=0,_this.lastShakeTime=(new Date).getTime(),_this.canvasXScale=1,_this.canvasYScale=1,_this.state={listLength:0},_this.drawIcon=_this.drawIcon.bind(_this),_this.shake=_this.shake.bind(_this),_this.handleResize=_this.handleResize.bind(_this),_this.genGiftImage=_this.genGiftImage.bind(_this),_this.clear=_this.clear.bind(_this),_this.draw=_this.draw.bind(_this),_this.addIcon=_this.addIcon.bind(_this),_this.destory=_this.destory.bind(_this),_this.getGiftMinYAxis=_this.getGiftMinYAxis.bind(_this),_this.setTipsPos=_this.setTipsPos.bind(_this),_this}return _inherits(CustomGift,_Component),_createClass(CustomGift,[{key:"componentDidMount",value:function(){this.canvas=this.refs.showCustomGiftCanvas,this.ctx=this.canvas.getContext("2d"),this.list=this.props.list,this.isLongpoll=this.props.isLongpoll,this.handleResize(),this.genGiftImage(this.props.iconSrc),this.setTipsPos(),this.setState({listLength:this.list.length}),this.checkList(this.list)&&this.draw()}},{key:"componentWillReceiveProps",value:function(nextProps){this.checkList(nextProps.list)&&nextProps.list!==this.props.list&&(this.list=nextProps.list,this.genGiftImage(nextProps.iconSrc),this.isLongpoll=nextProps.isLongpoll,this.handleResize(),this.setTipsPos(),this.setState({listLength:this.list.length}),this.draw())}},{key:"checkList",value:function(list){return list&&list.length&&0!==list.length}},{key:"getGiftMinYAxis",value:function(){var min=20;if(this.checkList(this.list)){min=this.list[0].y;var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.list[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var site=_step.value;site.y<min&&(min=site.y)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}return min}},{key:"setTipsPos",value:function(){var minY=(this.getGiftMinYAxis()-this.radius/4)/2;this.refs.customGiftDetailContainer.style.top=minY>20?Math.floor(minY)+"px":"20px"}},{key:"drawIcon",value:function(pos){var position=pos;this.image&&(this.ctx.save(),this.ctx.translate(position.x+this.radius/2,position.y+this.radius/2),this.ctx.rotate(this.rotation),this.ctx.drawImage(this.image,-this.radius/2,-this.radius/2,this.radius,this.radius),this.ctx.restore())}},{key:"shake",value:function(){if(void 0!==this.canvas&&this.checkList(this.list)){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var now=(new Date).getTime(),spendTime=now-this.lastShakeTime;this.ratateCount%60<30?(this.degree-=spendTime/15,this.rotation=this.rads(this.degree),this.ratateCount++):this.ratateCount%60>=30&&(this.degree+=spendTime/15,this.rotation=this.rads(this.degree),this.ratateCount++),this.list.forEach(this.drawIcon),this.lastShakeTime=now,window.requestAnimationFrame(this.shake)}}},{key:"rads",value:function(x){return Math.PI*x/180}},{key:"handleResize",value:function(){var self=this,showRect=self.canvas.getBoundingClientRect();self.canvas.width=2*showRect.width,self.canvas.height=2*showRect.height,self.isLongpoll&&(self.canvasXScale=showRect.width/1024,self.canvasYScale=showRect.width/1024,self.list.forEach(function(pos,index,l){l[index]={x:pos.x*self.canvasXScale,y:pos.y*self.canvasYScale}})),this.canvas.top=showRect.top+(document.body.scrollTop||document.documentElement.scrollTop),this.canvas.left=showRect.left+(document.body.scrollLeft||document.documentElement.scrollLeft)}},{key:"genGiftImage",value:function(imageSrc){var _this2=this;_nowUtilImagecache2.default.get(imageSrc).then(function(img){_this2.image=img})}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"draw",value:function(){this.lastShakeTime=(new Date).getTime(),window.requestAnimationFrame(this.shake)}},{key:"addIcon",value:function(position){this.list.push(position),this.drawIcon(position)}},{key:"destory",value:function(){this.canvas.parentNode.removeChild(this.canvas),this.canvas=void 0}},{key:"render",value:function(){return _react2.default.createElement("div",null,_react2.default.createElement("div",{className:"customGiftDetailContainer",ref:"customGiftDetailContainer"},_react2.default.createElement("div",{className:"customGiftDetail"},_react2.default.createElement("p",null,(this.props.anchorNick.length>8?this.props.anchorNick.slice(0,8)+"...":this.props.anchorNick)+"送出x"+this.props.list.length+"个")),_react2.default.createElement("img",{className:"customGiftPhoto",src:this.props.iconSrc})),_react2.default.createElement("canvas",{className:"customGiftShowPanel",ref:"showCustomGiftCanvas"}))}}]),CustomGift}(_react.Component);exports.default=CustomGift},1157:function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)(),exports.push([module.id,".customGiftShowPanel{position:fixed;top:40px;left:0;width:100%;height:100%;z-index:9;pointer-events:none}.customGiftDetailContainer{position:fixed;top:50px;left:50%;transform:translate(-50%)}.customGiftDetailContainer .customGiftDetail{font-size:16px;line-height:28px;height:28px;border:2px solid #ff544b;border-radius:28px;background-color:#fff}.customGiftDetailContainer .customGiftDetail p{padding:0;margin:0;max-width:260px;color:#777;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-indent:12px;padding-right:24px}.customGiftDetailContainer .customGiftPhoto{position:absolute;right:-9px;bottom:0;width:35px;height:35px}",""])},1558:[1831,1157],1831:function(module,exports,__webpack_require__,__webpack_module_template_argument_0__){var content=__webpack_require__(__webpack_module_template_argument_0__);"string"==typeof content&&(content=[[module.id,content,""]]);__webpack_require__(4)(content,{});content.locals&&(module.exports=content.locals)}});
//# sourceMappingURL=34.8bdc433d7cbfb7d954af.bundle.js.map